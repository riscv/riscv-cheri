// Sail source code
:sail-doc: src/cheri/generated/riscv_RV64.json

ifndef::cheri_standalone_spec[]
:cheri_ratification_v1_only: 1
endif::[]

:not_v1_ratification_package: This chapter is not part of the v1.0 ratification package.


///////////////////////////////////////////////////////////////////////////////
// Top-level CHERI definitions
///////////////////////////////////////////////////////////////////////////////

// Base CHERI extension (without the mode bit in capability format)
:cheri_base64_ext_name:    RV64Y
:cheri_base32_ext_name:    RV32Y
:cheri_base_ext_name:      RVY
// CHERI extension adding support for integer pointer mode (and mode bit)
:cheri_default_ext_name:   Zyhybrid
:cheri_priv_m_ext: Machine-Level ISA ({cheri_base_ext_name})
:cheri_priv_m_reg_enable_ext: {cheri_default_ext_name} for Privileged Architectures
ifdef::support_varxlen[]
:cheri_priv_m_dyn_xlen_ext: Smyvarxlen
endif::support_varxlen[]
:cheri_priv_s_ext: Supervisor-Level ISA ({cheri_base_ext_name})
:cheri_priv_h_ext: "H" Extension for Hypervisor Support ({cheri_base_ext_name})
:cheri_priv_vmem_ext: Supervisor-Level ISA for Virtual Memory ({cheri_base64_ext_name})
:cheri_priv_debug_trig: Sdtrig ({cheri_base_ext_name})

// 32-bit encodings added by RVY
:rvy_file_name:            {cheri_base_ext_name}_insns_table_body
// 32-bit encoding for YSENTRY
:rvy_sentry_insn_ext_name:      Zys
:rvy_sentry_insn_file_name:     {rvy_sentry_insn_ext_name}_insns_table_body
// 32-bit encodings modified by RVY
:rvy_i_mod_ext_name:       RVI ({cheri_base_ext_name} modified behavior)
:rvy_i_mod_file_name:      {cheri_base_ext_name}_I_mod_insns_table_body
:rvy_zicsr_mod_ext_name:   Zicsr ({cheri_base_ext_name} modified behavior)
:rvy_zicsr_mod_file_name:  {cheri_base_ext_name}_Zicsr_mod_insns_table_body
// 16-bit encodings added by RVY+C
:rvy_zca_ext_name:         C ({cheri_base_ext_name} added instructions)
:rvy_zca_file_name:        {cheri_base_ext_name}_Zca_insns_table_body
// 16-bit encodings modified by RVY+C
:rvy_zca_mod_ext_name:     C ({cheri_base_ext_name} modified behavior)
:rvy_zca_mod_file_name:    {cheri_base_ext_name}_Zca_mod_insns_table_body
// 32-bit encodings added by RVY+Zba
:rvy_zba_ext_name:         Zba ({cheri_base_ext_name} added instructions)
:rvy_zba_file_name:        {cheri_base_ext_name}_Zba_insns_table_body
// 32-bit encodings added by RVY+Zalrsc
:rvy_zalrsc_ext_name:      Zalrsc ({cheri_base_ext_name} added instructions)
:rvy_zalrsc_file_name:     {cheri_base_ext_name}_Zalrsc_insns_table_body
// 32-bit encodings added by RVY+Zaamo
:rvy_zaamo_ext_name:       Zaamo ({cheri_base_ext_name} added instructions)
:rvy_zaamo_file_name:      {cheri_base_ext_name}_Zaamo_insns_table_body
// 32-bit encodings added by RVY+A
:rvy_h_ext_name:           H Extension ({cheri_base_ext_name} added instructions)
:rvy_h_file_name:          {cheri_base_ext_name}_H_insns_table_body
// 32-bit encodings added by RVY+Zicbom
:rvy_zicbom_mod_ext_name:  Zicbom ({cheri_base_ext_name} modified behavior)
:rvy_zicbom_mod_file_name: {cheri_base_ext_name}_Zicbom_mod_insns_table_body
// 32-bit encodings added by RVY+Zicboz
:rvy_zicboz_mod_ext_name:  Zicboz ({cheri_base_ext_name} modified behavior)
:rvy_zicboz_mod_file_name: {cheri_base_ext_name}_Zicboz_mod_insns_table_body
// 32-bit encodings added by RVY+Zicbop
:rvy_zicbop_mod_ext_name:  Zicbop ({cheri_base_ext_name} modified behavior)
:rvy_zicbop_mod_file_name: {cheri_base_ext_name}_Zicbop_mod_insns_table_body
// 32-bit encodings added by Zyhybrid
:rvy_hybrid_file_name:     {cheri_default_ext_name}_insns_table_body

// Extension for supporting lr/sc.[bh]
:lr_sc_bh_ext_name:     Zabhlrsc

// Extension for CHERI CRG bits
:cheri_priv_crg_ext:          Svucrg
:cheri_priv_crg_load_tag_ext: Svucrglct

// Extension for capability levels (flow control)
:cheri_levels1_ext_name:             Zylevels1

:cheri_seal_ext_name: Zyseal

:ctag: capability tag
:ctag_cap:   Capability tag
:ctag_title: Capability Tag

:cheri_int_mode_name: pass:quotes[_(Non-CHERI) Address Mode_]
:cheri_cap_mode_name: pass:quotes[_(CHERI) Capability Mode_]

:c_cheri_base_ext_names:   C or Zca, {cheri_base_ext_name}
:c_cheri_default_ext_names: C or Zca, {cheri_default_ext_name}

:non-csrrw-or:  <<CSRRWI_CHERI>>, <<CSRRS_CHERI>>, <<CSRRSI_CHERI>>, <<CSRRC_CHERI>> or  <<CSRRCI_CHERI>>
:non-csrrw-and: <<CSRRWI_CHERI>>, <<CSRRS_CHERI>>, <<CSRRSI_CHERI>>, <<CSRRC_CHERI>> and <<CSRRCI_CHERI>>

:TAG_RESET_DCSR: The reset value of the {ctag} of this CSR is zero, the reset values of the metadata and address fields are UNSPECIFIED.
:TAG_RESET_MCSR: The reset value of the {ctag} of this CSR is zero, the reset values of the metadata and address fields are UNSPECIFIED.
:TAG_RESET_SCSR: At the start of the S-mode execution environment, the value of the {ctag} of this CSR is zero and the values of the metadata and address fields are UNSPECIFIED.
:REQUIRE_HYBRID_CSR: This CSR is only implemented if {cheri_default_ext_name} is implemented.
:ROOT_RX_RESET_SCSR: When the S-mode execution environment starts, the value is nominally the <<root-rx-cap>> capability.


:CAP_MODE_VALUE: 0
:INT_MODE_VALUE: 1

///////////////////////////////////////////////////////////////////////////////
// Cap definitions
///////////////////////////////////////////////////////////////////////////////

:cap_rv32_sdp_width:    2
:cap_rv64_sdp_width:    4
:cap_rv32_mw_width:    10
:cap_rv64_mw_width:    14
:cap_rv32_perms_width:  5
//GL is not a permission, so 8 not 9
:cap_rv64_perms_width:  8
:cap_rv32_addr_width:  32
:cap_rv64_addr_width:  64
:cap_rv32_exp_width:    5
:cap_rv32_exp_max:      24
:cap_rv64_exp_width:    6
:cap_rv64_exp_max:      52

// Base suffixes
:rv32y_uni_encoding_suffix: _Lymw{cap_rv32_mw_width}e{cap_rv32_exp_max}rc1pc
:rv64y_uni_encoding_suffix: _Lymw{cap_rv64_mw_width}e{cap_rv64_exp_max}rc1ps
:rv64y_uni_base_name: {cheri_base64_ext_name}{rv64y_uni_encoding_suffix}
:rvy64e_uni_base: {cheri_base64_ext_name}E{rv64y_uni_encoding_suffix}
:rv32y_uni_base_name: {cheri_base32_ext_name}{rv32y_uni_encoding_suffix}
:rv32ye_uni_base_name: {cheri_base32_ext_name}E{rv32y_uni_encoding_suffix}
// CHERIoT encoding scheme
:rvy_cheriot_encoding_suffix: _Lxymw9e14r0as11pc
:rvy32e_cheriot_base_name: {cheri_base32_ext_name}E{rvy_cheriot_encoding_suffix}


:cheri_excep_cause_pc:       32
:cheri_excep_cause_ld:       33
:cheri_excep_cause_st:       34
:cheri_excep_cause_pte_ld:   35
:cheri_excep_cause_pte_st:   36

:cheri_excep_name_pc:        CHERI Instruction Access Fault
:cheri_excep_name_ld:        CHERI Load Access Fault
:cheri_excep_name_st:        CHERI Store/AMO Access Fault
:cheri_excep_name_pte:       CHERI Page Fault
:cheri_excep_name_pte_ld:    CHERI Load Page Fault
:cheri_excep_name_pte_st:    CHERI Store/AMO Page Fault

:cheri_excep_desc_ytag:      Authorizing {ctag} is set to 0.
:cheri_excep_desc_seal:      Authorizing capability is sealed.
:cheri_excep_desc_perm:      Authorizing capability does not grant the necessary permissions.
:cheri_excep_desc_bnds:      At least one byte accessed is outside the authorizing capability bounds, or the bounds could not be decoded.
:cheri_excep_desc_intg:      Authorizing capability failed any <<section_cap_integrity,integrity>> check.

:cheri_excep_cause_ls_list:  {cheri_excep_cause_ld},{cheri_excep_cause_st}
:cheri_excep_cause_list:     {cheri_excep_cause_pc},{cheri_excep_cause_ls_list},{cheri_excep_cause_pte_ld},{cheri_excep_cause_pte_st}

:pcc: pc

//ISA naming
:CADD:         ADDY
:CADD_LC:      addy
:CADD_DESC:    Capability pointer increment

:CADDI:        ADDIY
:CADDI_LC:     addiy
:CADDI_DESC:   Capability pointer increment by immediate

:SCADDR:       YADDRW
:SCADDR_LC:    yaddrw
:SCADDR_DESC:  Write capability address

:SCBNDS:       YBNDSW
:SCBNDS_LC:    ybndsw
:SCBNDS_DESC:  Write capability bounds

:SCBNDSI:      YBNDSWI
:SCBNDSI_LC:   ybndswi
:SCBNDSI_DESC: Write capability bounds by immediate

:SCBNDSR:      YBNDSRW
:SCBNDSR_LC:   ybndsrw
:SCBNDSR_DESC: Write capability bounds, rounding up if required

:GCTAG:        YTAGR
:GCTAG_LC:     ytagr
:GCTAG_DESC:   Read {ctag}

:GCPERM:       YPERMR
:GCPERM_LC:    ypermr
:GCPERM_DESC:  Read capability permissions

:GCHI:         YHIR
:GCHI_LC:      yhir
:GCHI_DESC:    Read capability metadata (pseudo)

:GCBASE:       YBASER
:GCBASE_LC:    ybaser
:GCBASE_DESC:  Read capability base address

:GCTYPE:       YTYPER
:GCTYPE_LC:    ytyper
:GCTYPE_DESC:  Read capability type

:GCMODE:       YMODER
:GCMODE_LC:    ymoder
:GCMODE_DESC:  Read capability mode

:GCLEN:        YLENR
:GCLEN_LC:     ylenr
:GCLEN_DESC:   Read capability length

:SCHI:         YHIW
:SCHI_LC:      yhiw
:SCHI_DESC:    Write capability metadata and clear {ctag} (pseudo)

:SCEQ:         SYEQ
:SCEQ_LC:      syeq
:SCEQ_DESC:    Capability equality comparison including {ctag}

:SCSS:         YLT
:SCSS_LC:      ylt
:SCSS_DESC:    Capability less than comparison including {ctag}

:SCMODE:       YMODEW
:SCMODE_LC:    ymodew
:SCMODE_DESC:  Set capability execution mode

:C_MV_CAP:     C.YMV
:C_MV_CAP_LC:  c.ymv
:C_MV_CAP_DESC: Capability register copy, 16-bit encoding

:CMV:           YMV
:CMV_LC:        ymv
:CMV_DESC:      Capability register copy

:CBLD:          YBLD
:CBLD_LC:       ybld
:CBLD_DESC:     Build capability

:YSUNSEAL:      YSUNSEAL
:YSUNSEAL_LC:   ysunseal
:YSUNSEAL_DESC: Unseal by superset reconstruction

:CLRPERM:       YPERMC
:CLRPERM_LC:    ypermc
:CLRPERM_DESC:  Clear capability permissions

:CRAM:          YAMASK
:CRAM_LC:       yamask
:CRAM_DESC:     Capability alignment mask

:C_ADDI16SP_CAP:      C.ADDI16SP
:C_ADDI16SP_CAP_LC:   c.addi16sp
:C_ADDI16SP_CAP_DESC: Stack pointer increment in blocks of 16, 16-bit encoding

:C_ADDI4SPN_CAP:      C.ADDI4SPN
:C_ADDI4SPN_CAP_LC:   c.addi4spn
:C_ADDI4SPN_CAP_DESC: Stack pointer increment in blocks of 4, 16-bit encoding

:MODESW_CAP:      YMODESWY
:MODESW_CAP_LC:   ymodeswy
:MODESW_CAP_DESC: Switch execution to {cheri_cap_mode_name}

:MODESW_INT:      YMODESWI
:MODESW_INT_LC:   ymodeswi
:MODESW_INT_DESC: Switch execution to {cheri_int_mode_name}

:SH1ADD_CHERI:    SH1ADDY
:SH1ADD_CHERI_LC: sh1addy
:SH2ADD_CHERI:    SH2ADDY
:SH2ADD_CHERI_LC: sh2addy
:SH3ADD_CHERI:    SH3ADDY
:SH3ADD_CHERI_LC: sh3addy
:SH4ADD_CHERI:    SH4ADDY
:SH4ADD_CHERI_LC: sh4addy

:SENTRY:                  YSENTRY
:SENTRY_LC:               ysentry
:SENTRY_DESC:             Seal capability as a sentry

:SH1ADD_UW_CHERI:    SH1ADDY.UW
:SH1ADD_UW_CHERI_LC: sh1addy.uw
:SH2ADD_UW_CHERI:    SH2ADDY.UW
:SH2ADD_UW_CHERI_LC: sh2addy.uw
:SH3ADD_UW_CHERI:    SH3ADDY.UW
:SH3ADD_UW_CHERI_LC: sh3addy.uw
:SH4ADD_UW_CHERI:    SH4ADDY.UW
:SH4ADD_UW_CHERI_LC: sh4addy.uw
:ADD_UW_CHERI:       ADDY.UW
:ADD_UW_CHERI_LC:    addy.uw

:SH1ADD_UW_CHERI:    SH1ADDY.UW
:SH1ADD_UW_CHERI_LC: sh1addy.uw
:SH2ADD_UW_CHERI:    SH2ADDY.UW
:SH2ADD_UW_CHERI_LC: sh2addy.uw
:SH3ADD_UW_CHERI:    SH3ADDY.UW
:SH3ADD_UW_CHERI_LC: sh3addy.uw
:SH4ADD_UW_CHERI:    SH4ADDY.UW
:SH4ADD_UW_CHERI_LC: sh4addy.uw
:ADD_UW_CHERI:       ADDY.UW
:ADD_UW_CHERI_LC:    addy.uw

:LD_ST_DOT_CAP:           .Y
:ld_st_dot_cap_lc:        .y

:LOAD_CAP_NAME:           LY
:load_cap_name_lc:        ly
:LOAD_CAP_DESC:           Load capability

:GCHI_BASE:               SRLIY
:GCHI_BASE_LC:            srliy
:GCHI_BASE_DESC:          Logical right shift of Y register

:SCHI_BASE:               PACKY
:SCHI_BASE_LC:            packy
:SCHI_BASE_DESC:          Pack Y register

:LOAD_RES_CAP_DESC:       Load Reserved capability
:STORE_COND_CAP_DESC:     Store Conditional capability
:AMOSWAP_CAP_DESC:        Atomic swap of capabilities

:C_LOAD_CAP_NAME:        C.LY
:c_load_cap_name_lc:     c.ly
:C_LOAD_CAP_NAME_DESC:   Load capability, 16-bit encoding

:C_STORE_CAP_NAME:        C.SY
:c_store_cap_name_lc:     c.sy
:C_STORE_CAP_NAME_DESC:   Store capability, 16-bit encoding

:C_LOAD_CAP_SP_NAME:      C.LYSP
:c_load_cap_sp_name_lc:   c.lysp
:C_LOAD_CAP_SP_NAME_DESC: Load capability stack pointer relative, 16-bit encoding

:STORE_CAP_NAME:           SY
:store_cap_name_lc:        sy
:STORE_CAP_DESC:           Store capability
:C_STORE_CAP_SP_NAME:      C.SYSP
:c_store_cap_sp_name_lc:   c.sysp
:C_STORE_CAP_SP_NAME_DESC: Store capability stack pointer relative, 16-bit encoding

//these don't have vars for names as they haven't (recently) been renamed
:AUIPC_CHERI_DESC:         Add upper immediate to <<pcc>>
:JAL_CHERI_DESC:           Immediate offset jump, and link and seal to capability register
:JALR_CHERI_DESC:          Jump to capability register, and link and seal to capability register

:C_J_CHERI_DESC:           Immediate offset jump, 16-bit encoding
:C_JAL_CHERI_DESC:         {JAL_CHERI_DESC}, 16-bit encoding
:C_JALR_CHERI_DESC:        {JALR_CHERI_DESC}, 16-bit encoding
:C_JR_CHERI_DESC:          Jump to capability register, 16-bit encoding


:YSEAL:      YSEAL
:YSEAL_LC:   yseal
:YSEAL_DESC: Seal a capability using a sealing capability

:YUNSEAL:    YUNSEAL
:YUNSEAL_LC: yunseal
:YUNSEAL_DESC: Unseal a capability using an unsealing capability

// Variables for register names
// Prefix for numbered registers
:creg: x
// Capability operand names for srcs/dsts
// Use a macro here to allow distinguishing them again if we decide it's needed in the future.
:cd: rd
:cs1: rs1
:cs2: rs2
// No prefix for ABI register names
:abi_creg:
:CRE: Y
