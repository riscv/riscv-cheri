== Introduction

ifdef::cheri_standalone_spec[]
WARNING: This chapter is only included in the standalone CHERI spec and not part of the integrated document.
endif::[]

=== CHERI Concepts and Terminology

Current CPU architectures (including RISC-V) allow memory access solely by
specifying and dereferencing a memory address stored as an integer value in
a register or in memory. Any accidental or malicious action that modifies
such an integer value can result in unrestricted access to the memory that
it addresses. Unfortunately, this weak memory protection model has resulted
in the majority of software security vulnerabilities present in software
today.

CHERI enables software to efficiently implement fine-grained memory protection
and scalable software compartmentalization by providing strong, efficient
hardware mechanisms to support software execution and enable it to prevent
and mitigate vulnerabilities.

Design goals include incremental adoptability from current ISAs and software
stacks, low performance overhead for memory protection, significant performance
improvements for software compartmentalization, formal grounding, and
programmer-friendly underpinnings. It has been designed to provide strong,
non-probabilistic protection rather than depending on short random numbers or
truncated cryptographic hashes that can be leaked and reinjected, or that could
be brute forced.

=== CHERI Extensions to RISC-V

This specification is based on publicly available documentation including
CHERI v9 cite:[cheri-v9-spec] and CHERI Concentrate cite:[woodruff2019cheri].

Compatibility with RVA, RVB and RVM profiles will be listed in separate {cheri_base_ext_name} based profiles ({cheri_base_ext_name}A, {cheri_base_ext_name}B, {cheri_base_ext_name}M).
These will list the compatible extensions.

NOTE: Most existing extensions are compatible with {cheri_base_ext_name} with no modifications.
 Incompatible extensions will be listed in the profile documents.

IMPORTANT: Zicfiss is currently incompatible. An {cheri_base_ext_name} version has not yet been developed.

This section lists new extensions available to {cheri_base_ext_name}, and also extensions where the behavior is modified for {cheri_base_ext_name}.

{cheri_base_ext_name} is defined as the base ISA that all CHERI RISC-V implementations must support.
{cheri_default_ext_name} and {cheri_priv_crg_ext} are examples of optional extensions in addition to
{cheri_base_ext_name}.

In some cases adding an existing extension, such as H, causes additional instructions to be added.

In other cases adding an existing extension, such as C, causes additional instructions to be added and existing instructions to have modified behavior.

==== Stable Extensions and Specifications

.Unprivileged stable {cheri_base_ext_name} extensions
[#unpriv-extension-status,reftext="Extension Status and Summary"]
[options=header,align=center,width="90%"]
|=============================================================================================================================================================
| Extension or Specification                                | Description
|<<rv32y,{cheri_base_ext_name}>>                            | Base ISA
|<<rvy64_cap_description,{rvy64_uni_base_name}>>            | 64-bit capability encoding
|<<rvy32_cap_description,{rvy32_uni_base_name}>>            | 32-bit capability encoding
|<<section_rvy_sentry_insn_ext>>                            | Ambient capability sealing instruction
|<<section_cheri_hybrid_ext,{cheri_default_ext_name}>>      | Hybrid extension for RVI compatibility
|<<rvy_zca_insn_table,   {rvy_zca_ext_name}>>               | New 16-bit encodings added to Zca
|<<rvy_zba_insn_table,   {rvy_zba_ext_name}>>               | New 32-bit encodings added to Zba
|<<rvy_zalrsc_insn_table,{rvy_zalrsc_ext_name}>>            | New 32-bit encodings added to Zalrsc
|<<rvy_zaamo_insn_table, {rvy_zaamo_ext_name}>>             | New 32-bit encodings added to Zaamo
|=============================================================================================================================================================

.Unprivileged stable extensions where {cheri_base_ext_name} modifies the behavior
[#unpriv-mod-extension-status,reftext="Extension Status and Summary"]
[options=header,align=center,width="90%"]
|=============================================================================================================================================================
| Extension or Specification                                | Description
|<<{rvy_i_mod_file_name},     {rvy_i_mod_ext_name}>>        | RVI instructions modified by {cheri_base_ext_name}
|<<{rvy_zca_mod_file_name},   {rvy_zca_mod_ext_name}>>      | Zca instructions modified by {cheri_base_ext_name}
|<<{rvy_zicsr_mod_file_name}, {rvy_zicsr_mod_ext_name}>>    | Zicsr instructions modified by {cheri_base_ext_name}
|<<{rvy_zicbom_mod_file_name},{rvy_zicbom_mod_ext_name}>>   | Zicbom instructions modified by {cheri_base_ext_name}
|<<{rvy_zicboz_mod_file_name},{rvy_zicboz_mod_ext_name}>>   | Zicboz instructions modified by {cheri_base_ext_name}
|<<{rvy_zicbop_mod_file_name},{rvy_zicbop_mod_ext_name}>>   | Zicbop instructions modified by {cheri_base_ext_name}
|=============================================================================================================================================================


.Unprivileged stable extension used by CHERI software
[#zabhlrsc_unpriv-extension-status,reftext="Extension Status and Summary"]
[options=header,align=center,width="90%"]
|=============================================================================================================================================================
| Extension or Specification                                | Description
|<<abhlrsc_ext,     {lr_sc_bh_ext_name}>>                   | Byte and halfword LR/SC functionality
|=============================================================================================================================================================

.Privileged stable extensions and specifications
[#priv-extension-status,reftext="Extension Status and Summary"]
[options=header,align=center,width="90%"]
|=============================================================================================================================================================
| Extension or Specification                                | Description
|<<section_priv_cheri,{cheri_priv_m_ext}>>                  | Machine ISA
|<<section_priv_cheri,{cheri_priv_s_ext}>>                  | Supervisor ISA
|<<section_cheri_disable,{cheri_priv_m_reg_enable_ext}>>    | Hybrid extension for RVI compatibility
ifdef::support_varxlen[]
|<<section_cheri_dyn_xlen,{cheri_priv_m_dyn_xlen_ext}>>     | Dynamic XLEN support
endif::support_varxlen[]
|<<section_priv_cheri_vmem,{cheri_priv_vmem_ext}>>          | Virtual Memory
|<<section_debug_integration_trig,{cheri_priv_debug_trig}>> | Debug triggers
|<<section_cheri_priv_crg_ext,    {cheri_priv_crg_ext}>>^1^ | MMU-based acceleration of capability revocation for heap temporal safety
|=============================================================================================================================================================

^1^ {cheri_priv_crg_load_tag_ext} is available for improved software revocation performance if {cheri_priv_crg_ext} is implemented.

.Debug stable extensions and specifications
[#debug-extension-status,reftext="Extension Status and Summary"]
[options=header,align=center,width="90%"]
|=============================================================================================================================================================
| Extension or Specification                                       | Description
|<<section_debug_integration_ext,Sdext ({cheri_base_ext_name})>>   | External debug support
|=============================================================================================================================================================

ifdef::cheri_ratification_v1_only[]

==== Unratified RISC-V Standard Extensions for {cheri_base_ext_name}

Future version of this specification will include {cheri_base_ext_name} versions of:

* "H" extension
* "V" extension
* Pointer masking extensions (Ssnpm, Smnpm, Smmpm, Sspm, Supm)
* Code size reduction: Zcmt, Zcmp

endif::[]

ifndef::cheri_ratification_v1_only[]

==== Experimental Extensions and Specifications

The extensions in this section have not been fully prototyped and so are not considered ratification ready.

.Unprivileged experimental extensions and specifications
[#unpriv-exp-extension-status,reftext="Extension Status and Summary"]
[options=header,align=center,width="90%"]
|=============================================================================================================================================================
| Extension                                                 | Description
|<<section_cheri_vector_integration>>                       | Vector
|<<ZCMT_CHERI>>                                             | Table Jump for {cheri_base32_ext_name}
|<<ZCMP_CHERI>>                                             | Push/pop and double move for {cheri_base32_ext_name}
|<<section_xycheriot>>                                      | CHERIoT capability encoding
|<<section_zyseal>>                                         | Capability-mediated capability (un)sealing instructions
|=============================================================================================================================================================

.Privileged experimental extensions and specifications
[#priv-exp-extension-status,reftext="Extension Status and Summary"]
[options=header,align=center,width="90%"]
|=============================================================================================================================================================
| Extension                                                 | Description
|<<section_cheri_hypervisor_integration>>                   | Hypervisor
|<<section_cheri_pointer_masking_integration>>              | Pointer Masking
|=============================================================================================================================================================

endif::[]
